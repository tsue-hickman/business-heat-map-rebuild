<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Business Heat Map</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <div class="dashboard-header">
        <h1>Welcome, {{ current_user.username }}!</h1>
        <div class="user-info">
          <span
            class="badge badge-{{ 'admin' if current_user.is_admin() else 'user' }}"
          >
            {{ 'Admin' if current_user.is_admin() else 'User' }}
          </span>
          <a href="{{ url_for('auth.logout') }}" class="btn btn-sm">Logout</a>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %} {% endif %} {% endwith %}

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Your Locations</h3>
          <div class="stat-number">{{ user_locations|length }}</div>
        </div>
        <div class="stat-card">
          <h3>Total Locations</h3>
          <div class="stat-number">{{ total_locations }}</div>
        </div>
        <div class="stat-card">
          <h3>ZIP Codes</h3>
          <div class="stat-number">{{ total_demographics }}</div>
        </div>
        {% if current_user.is_admin() %}
        <div class="stat-card">
          <h3>Total Users</h3>
          <div class="stat-number">{{ total_users }}</div>
        </div>
        {% endif %}
      </div>

      <div class="info-box">
        <h2>Your Business Locations</h2>
        {% if user_locations %}
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Address</th>
              <th>City</th>
              <th>State</th>
              <th>ZIP</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            {% for location in user_locations %}
            <tr>
              <td>{{ location.name }}</td>
              <td>{{ location.address }}</td>
              <td>{{ location.city }}</td>
              <td>{{ location.state }}</td>
              <td>{{ location.zip_code }}</td>
              <td>{{ location.business_type or 'N/A' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>You haven't added any locations yet.</p>
        {% endif %}
      </div>

      <div class="dashboard-actions">
        <a href="{{ url_for('main.home') }}" class="btn">View Heat Map</a>
        {% if current_user.is_admin() %}
        <a href="{{ url_for('admin.panel') }}" class="btn btn-primary"
          >Admin Panel</a
        >
        {% endif %}
      </div>
    </div>
  </body>
</html>
