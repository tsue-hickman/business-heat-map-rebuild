<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Location - Business Heat Map</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      .form-container {
        max-width: 600px;
        margin: 0 auto;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }

      .form-row.full {
        grid-template-columns: 1fr;
      }

      .help-text {
        font-size: 0.85em;
        color: #666;
        margin-top: 5px;
      }

      .optional-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .optional-section h3 {
        margin-top: 0;
        font-size: 1.1em;
        color: #555;
      }

      /* Search box styling */
      .zip-search-wrapper {
        position: relative;
      }

      .zip-search-input {
        width: 100%;
        padding: 10px 35px 10px 10px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1em;
      }

      .search-icon {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #667eea;
        font-size: 18px;
      }

      .zip-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        max-height: 200px;
        overflow-y: auto;
        background: white;
        border: 2px solid #667eea;
        border-top: none;
        border-radius: 0 0 6px 6px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .zip-dropdown.show {
        display: block;
      }

      .zip-option {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
      }

      .zip-option:hover {
        background: #f0f0f0;
      }

      .zip-option:last-child {
        border-bottom: none;
      }

      .zip-code-text {
        font-weight: bold;
        color: #667eea;
      }

      .city-text {
        color: #666;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-container">
        <div class="dashboard-header">
          <h1>üìç Add Business Location</h1>
          <div class="user-info">
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm"
              >‚Üê Back to Dashboard</a
            >
          </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %} {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %} {% endif %} {% endwith %}

        <div class="info-box">
          <h2>Location Information</h2>
          <p>
            Add a new business location to track on the heat map. All fields
            marked with * are required.
          </p>

          <form method="POST" action="{{ url_for('main.add_location') }}">
            <!-- Business Name -->
            <div class="form-group">
              <label for="name">Business/Property Name *</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="e.g., Smith Residence, ABC Corp Office"
              />
            </div>

            <!-- Address -->
            <div class="form-group">
              <label for="address">Street Address *</label>
              <input
                type="text"
                id="address"
                name="address"
                required
                placeholder="e.g., 123 Main Street"
              />
            </div>

            <!-- ZIP Code with Search/Dropdown -->
            <div class="form-group">
              <label for="zip_code">ZIP Code * (Search or Select)</label>
              <div class="zip-search-wrapper">
                <input
                  type="text"
                  id="zip_code"
                  name="zip_code"
                  class="zip-search-input"
                  placeholder="Type to search ZIP codes..."
                  required
                  autocomplete="off"
                />
                <span class="search-icon">üîç</span>
                <div id="zip-dropdown" class="zip-dropdown"></div>
              </div>
              <small class="help-text"
                >Start typing ZIP code or city name</small
              >
            </div>

            <!-- City and State (auto-filled from ZIP selection) -->
            <div class="form-row">
              <div class="form-group">
                <label for="city">City *</label>
                <input
                  type="text"
                  id="city"
                  name="city"
                  required
                  placeholder="Auto-filled from ZIP"
                  readonly
                />
              </div>

              <div class="form-group">
                <label for="state">State *</label>
                <input
                  type="text"
                  id="state"
                  name="state"
                  required
                  placeholder="Auto-filled"
                  readonly
                />
              </div>
            </div>

            <!-- Business Type -->
            <div class="form-group">
              <label for="business_type">Property Type *</label>
              <select id="business_type" name="business_type" required>
                <option value="">Select Type...</option>
                <option value="residential">Residential Home</option>
                <option value="office">Office Building</option>
                <option value="retail">Retail Store</option>
                <option value="restaurant">Restaurant</option>
                <option value="medical">Medical Facility</option>
                <option value="hotel">Hotel/Hospitality</option>
                <option value="education">School/University</option>
                <option value="warehouse">Warehouse/Industrial</option>
                <option value="government">Government Building</option>
                <option value="religious">Church/Religious</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- Optional: Coordinates -->
            <div class="optional-section">
              <h3>üìç Exact Coordinates (Optional)</h3>
              <p style="font-size: 0.9em; color: #666">
                Coordinates will be auto-filled based on ZIP code. You can
                override if needed.
              </p>

              <div class="form-row">
                <div class="form-group">
                  <label for="latitude">Latitude</label>
                  <input
                    type="number"
                    id="latitude"
                    name="latitude"
                    step="any"
                    placeholder="e.g., 39.0997"
                    readonly
                  />
                </div>

                <div class="form-group">
                  <label for="longitude">Longitude</label>
                  <input
                    type="number"
                    id="longitude"
                    name="longitude"
                    step="any"
                    placeholder="e.g., -94.5786"
                    readonly
                  />
                </div>
              </div>
            </div>

            <!-- Notes -->
            <div class="form-group">
              <label for="notes">Notes (Optional)</label>
              <textarea
                id="notes"
                name="notes"
                rows="4"
                placeholder="Window count, special requirements, etc..."
              ></textarea>
            </div>

            <!-- Submit Button -->
            <div class="form-group">
              <button type="submit" class="btn btn-primary btn-block">
                ‚úÖ Add Location
              </button>
            </div>
          </form>
        </div>

        <div
          class="info-box"
          style="background: #e7f3ff; border-left: 4px solid #2196f3"
        >
          <h3 style="margin-top: 0">üí° Quick Tip</h3>
          <p>
            After adding your location, view it on the interactive heat map to
            see demographic data for the area (median income, population, home
            values).
          </p>
          <a href="{{ url_for('main.map_view') }}" class="btn btn-sm"
            >View Map</a
          >
        </div>
      </div>
    </div>

    <script>
      // Complete ZIP code data for Atlantic IA, St Joseph MO, and Leavenworth KS regions
      const zipData = {
        // Atlantic Iowa Region - Full List
        50002: { city: "Adair", state: "IA", lat: 41.5011, lng: -94.6405 },
        50020: { city: "Adel", state: "IA", lat: 41.6144, lng: -94.0175 },
        50022: { city: "Anita", state: "IA", lat: 41.5914, lng: -94.7633 },
        50025: { city: "Atlantic", state: "IA", lat: 41.4036, lng: -95.0139 },
        50042: { city: "Bagley", state: "IA", lat: 41.8508, lng: -94.4344 },
        50048: { city: "Brayton", state: "IA", lat: 41.5503, lng: -94.9242 },
        50076: { city: "Cumberland", state: "IA", lat: 41.2711, lng: -94.8658 },
        50117: { city: "Elk Horn", state: "IA", lat: 41.5911, lng: -95.0589 },
        50274: { city: "Wiota", state: "IA", lat: 41.4047, lng: -94.8747 },
        50833: { city: "Avoca", state: "IA", lat: 41.4778, lng: -95.3378 },
        50837: { city: "Carson", state: "IA", lat: 41.2292, lng: -95.4169 },
        50839: { city: "Defiance", state: "IA", lat: 41.8203, lng: -95.3414 },
        50841: { city: "Earling", state: "IA", lat: 41.7817, lng: -95.4336 },
        50843: { city: "Elliott", state: "IA", lat: 41.1467, lng: -95.1622 },
        50846: { city: "Griswold", state: "IA", lat: 41.2336, lng: -95.1386 },
        50847: { city: "Hancock", state: "IA", lat: 41.3928, lng: -95.3658 },
        50848: { city: "Harlan", state: "IA", lat: 41.6531, lng: -95.3256 },
        50853: { city: "Kimballton", state: "IA", lat: 41.6239, lng: -95.0781 },
        50857: { city: "Lewis", state: "IA", lat: 41.305, lng: -95.0847 },
        50859: { city: "Marne", state: "IA", lat: 41.4603, lng: -95.1022 },
        50862: { city: "Massena", state: "IA", lat: 41.2539, lng: -94.7692 },
        50864: { city: "Oakland", state: "IA", lat: 41.3122, lng: -95.3947 },
        51010: { city: "Akron", state: "IA", lat: 42.8281, lng: -96.5606 },
        51040: { city: "Hawarden", state: "IA", lat: 42.9958, lng: -96.4839 },
        51060: {
          city: "Orange City",
          state: "IA",
          lat: 43.0064,
          lng: -96.0583,
        },
        51439: { city: "Arion", state: "IA", lat: 41.955, lng: -95.4575 },
        51442: {
          city: "Charter Oak",
          state: "IA",
          lat: 42.0697,
          lng: -95.5925,
        },
        51446: { city: "Defiance", state: "IA", lat: 41.8203, lng: -95.3414 },
        51447: { city: "Deloit", state: "IA", lat: 42.0908, lng: -95.3125 },
        51454: { city: "Dow City", state: "IA", lat: 41.9275, lng: -95.4942 },
        51455: { city: "Dunlap", state: "IA", lat: 41.8544, lng: -95.6003 },
        51460: { city: "Irwin", state: "IA", lat: 41.7861, lng: -95.2106 },
        51465: { city: "Kirkman", state: "IA", lat: 41.7311, lng: -95.2678 },
        51510: {
          city: "Carter Lake",
          state: "IA",
          lat: 41.2889,
          lng: -95.9178,
        },
        51520: {
          city: "Council Bluffs",
          state: "IA",
          lat: 41.2619,
          lng: -95.8608,
        },
        51521: {
          city: "Council Bluffs",
          state: "IA",
          lat: 41.2358,
          lng: -95.8472,
        },
        51523: {
          city: "Council Bluffs",
          state: "IA",
          lat: 41.2878,
          lng: -95.7961,
        },
        51525: { city: "Crescent", state: "IA", lat: 41.3633, lng: -95.8589 },
        51526: { city: "Emerson", state: "IA", lat: 41.0169, lng: -95.4089 },
        51527: { city: "Glenwood", state: "IA", lat: 41.0464, lng: -95.7425 },
        51528: { city: "Hancock", state: "IA", lat: 41.3928, lng: -95.3658 },
        51529: { city: "Hastings", state: "IA", lat: 41.0206, lng: -95.5322 },
        51530: { city: "Henderson", state: "IA", lat: 41.1581, lng: -95.4339 },
        51531: {
          city: "Honey Creek",
          state: "IA",
          lat: 41.3708,
          lng: -95.8928,
        },
        51532: { city: "McClelland", state: "IA", lat: 41.3278, lng: -95.6778 },
        51533: { city: "Macedonia", state: "IA", lat: 41.1936, lng: -95.4328 },
        51535: { city: "Malvern", state: "IA", lat: 41.0028, lng: -95.5803 },
        51536: { city: "Mineola", state: "IA", lat: 41.3008, lng: -95.7503 },
        51537: { city: "Minden", state: "IA", lat: 41.465, lng: -95.5486 },
        51540: {
          city: "Missouri Valley",
          state: "IA",
          lat: 41.5586,
          lng: -95.8939,
        },
        51541: { city: "Modale", state: "IA", lat: 41.6297, lng: -96.0194 },
        51542: { city: "Mondamin", state: "IA", lat: 41.7181, lng: -96.0219 },
        51543: { city: "Neola", state: "IA", lat: 41.4511, lng: -95.6178 },
        51544: { city: "Oakland", state: "IA", lat: 41.3122, lng: -95.3947 },
        51545: {
          city: "Pacific Junction",
          state: "IA",
          lat: 41.0208,
          lng: -95.7994,
        },
        51546: { city: "Panama", state: "IA", lat: 41.7178, lng: -95.4722 },
        51549: { city: "Persia", state: "IA", lat: 41.5803, lng: -95.5678 },
        51550: { city: "Portsmouth", state: "IA", lat: 41.6425, lng: -95.5375 },
        51552: { city: "Red Oak", state: "IA", lat: 41.0097, lng: -95.225 },
        51553: { city: "Shelby", state: "IA", lat: 41.5039, lng: -95.4536 },
        51555: {
          city: "Silver City",
          state: "IA",
          lat: 41.1081,
          lng: -95.6436,
        },
        51556: { city: "Stanton", state: "IA", lat: 40.9831, lng: -95.105 },
        51557: { city: "Tabor", state: "IA", lat: 40.8983, lng: -95.6658 },
        51558: { city: "Treynor", state: "IA", lat: 41.2319, lng: -95.6139 },
        51559: { city: "Underwood", state: "IA", lat: 41.3836, lng: -95.68 },
        51560: { city: "Walnut", state: "IA", lat: 41.4811, lng: -95.2281 },
        51562: { city: "Westphalia", state: "IA", lat: 41.7136, lng: -95.3953 },
        51563: { city: "Woodbine", state: "IA", lat: 41.7383, lng: -95.7011 },
        51564: { city: "Villisca", state: "IA", lat: 40.9308, lng: -94.9781 },
        51565: { city: "Grant", state: "IA", lat: 41.1142, lng: -95.0364 },
        51566: { city: "Blanchard", state: "IA", lat: 40.5847, lng: -95.2139 },
        51570: { city: "Clarinda", state: "IA", lat: 40.7406, lng: -95.0372 },
        51572: { city: "Coin", state: "IA", lat: 40.6544, lng: -95.2447 },
        51573: {
          city: "College Springs",
          state: "IA",
          lat: 40.6189,
          lng: -95.1447,
        },
        51576: { city: "Essex", state: "IA", lat: 40.8236, lng: -95.3078 },
        51577: { city: "Farragut", state: "IA", lat: 40.7219, lng: -95.4711 },
        51578: { city: "Imogene", state: "IA", lat: 40.8817, lng: -95.4153 },
        51579: { city: "Northboro", state: "IA", lat: 40.6217, lng: -95.3278 },
        51601: { city: "Shenandoah", state: "IA", lat: 40.7658, lng: -95.3769 },
        51630: {
          city: "Braddyville",
          state: "IA",
          lat: 40.5889,
          lng: -95.4106,
        },
        51631: { city: "Clarinda", state: "IA", lat: 40.7406, lng: -95.0372 },
        51632: { city: "Hamburg", state: "IA", lat: 40.6072, lng: -95.6544 },
        51636: { city: "Percival", state: "IA", lat: 40.7428, lng: -95.7783 },
        51637: { city: "Randolph", state: "IA", lat: 40.8744, lng: -95.5753 },
        51638: { city: "Riverton", state: "IA", lat: 40.6778, lng: -95.5578 },
        51639: { city: "Shambaugh", state: "IA", lat: 40.6636, lng: -95.0208 },
        51640: { city: "Sidney", state: "IA", lat: 40.7489, lng: -95.6472 },
        51645: { city: "Thurman", state: "IA", lat: 40.8164, lng: -95.7508 },
        51646: {
          city: "Little Sioux",
          state: "IA",
          lat: 41.8081,
          lng: -96.0472,
        },
        51647: { city: "Logan", state: "IA", lat: 41.6439, lng: -95.7881 },
        51648: { city: "Magnolia", state: "IA", lat: 41.6939, lng: -95.8856 },
        51649: { city: "Mondamin", state: "IA", lat: 41.7181, lng: -96.0219 },
        51650: { city: "Moorhead", state: "IA", lat: 41.9228, lng: -95.8581 },
        51651: { city: "Moville", state: "IA", lat: 42.4892, lng: -96.0728 },
        51652: { city: "Newell", state: "IA", lat: 42.6086, lng: -95.0075 },
        51653: { city: "Onawa", state: "IA", lat: 42.0253, lng: -96.0989 },
        51654: { city: "Pisgah", state: "IA", lat: 41.8294, lng: -95.9328 },
        51656: { city: "Soldier", state: "IA", lat: 41.9886, lng: -95.7706 },
        68410: {
          city: "Nebraska City",
          state: "NE",
          lat: 40.6767,
          lng: -95.8594,
        },

        // St. Joseph Missouri Region
        64501: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7684,
          lng: -94.8467,
        },
        64503: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7447,
          lng: -94.8163,
        },
        64504: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7905,
          lng: -94.7961,
        },
        64505: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7275,
          lng: -94.8769,
        },
        64506: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7684,
          lng: -94.8467,
        },
        64507: {
          city: "Saint Joseph",
          state: "MO",
          lat: 39.7447,
          lng: -94.8163,
        },

        // Nearby MO cities
        64424: { city: "Agency", state: "MO", lat: 39.6503, lng: -94.7572 },
        64433: { city: "De Kalb", state: "MO", lat: 39.6006, lng: -94.9156 },
        64443: { city: "Easton", state: "MO", lat: 39.7447, lng: -94.6328 },
        64444: { city: "Faucett", state: "MO", lat: 39.6022, lng: -94.7819 },
        64476: { city: "Rushville", state: "MO", lat: 39.5764, lng: -95.0144 },

        // Leavenworth Kansas Region
        66002: { city: "Atchison", state: "KS", lat: 39.5631, lng: -95.1218 },
        66007: { city: "Basehor", state: "KS", lat: 39.1436, lng: -94.9378 },
        66012: {
          city: "Bonner Springs",
          state: "KS",
          lat: 39.0589,
          lng: -94.8836,
        },
        66020: { city: "Cummings", state: "KS", lat: 39.405, lng: -95.2472 },
        66021: { city: "Easton", state: "KS", lat: 39.34, lng: -95.1119 },
        66023: { city: "Effingham", state: "KS", lat: 39.5222, lng: -95.3978 },
        66027: {
          city: "Leavenworth",
          state: "KS",
          lat: 39.3111,
          lng: -94.9225,
        },
        66043: {
          city: "Fort Leavenworth",
          state: "KS",
          lat: 39.3553,
          lng: -94.9178,
        },
        66048: {
          city: "Leavenworth",
          state: "KS",
          lat: 39.3697,
          lng: -94.9858,
        },
        66049: { city: "Lancaster", state: "KS", lat: 39.5653, lng: -95.3 },
        66050: { city: "Lansing", state: "KS", lat: 39.2486, lng: -94.9003 },
        66060: { city: "Muscotah", state: "KS", lat: 39.5569, lng: -95.5206 },

        // Kansas City Metro for Reference
        64030: { city: "Grandview", state: "MO", lat: 38.8861, lng: -94.5333 },
        64101: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0997,
          lng: -94.5786,
        },
        64102: {
          city: "Kansas City",
          state: "MO",
          lat: 39.1008,
          lng: -94.5822,
        },
        64105: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0931,
          lng: -94.5828,
        },
        64106: {
          city: "Kansas City",
          state: "MO",
          lat: 39.1139,
          lng: -94.5744,
        },
        64108: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0486,
          lng: -94.5847,
        },
        64109: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0361,
          lng: -94.5853,
        },
        64110: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0158,
          lng: -94.5689,
        },
        64111: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0508,
          lng: -94.5953,
        },
        64112: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0399,
          lng: -94.5919,
        },
        64113: {
          city: "Kansas City",
          state: "MO",
          lat: 39.0031,
          lng: -94.5936,
        },
        64114: {
          city: "Kansas City",
          state: "MO",
          lat: 38.9647,
          lng: -94.5761,
        },
        66103: {
          city: "Kansas City",
          state: "KS",
          lat: 39.1142,
          lng: -94.6744,
        },
        66204: {
          city: "Overland Park",
          state: "KS",
          lat: 39.0267,
          lng: -94.6689,
        },
        66207: {
          city: "Overland Park",
          state: "KS",
          lat: 38.9822,
          lng: -94.6708,
        },
        66062: { city: "Shawnee", state: "KS", lat: 39.0417, lng: -94.7203 },
      };

      const zipInput = document.getElementById("zip_code");
      const zipDropdown = document.getElementById("zip-dropdown");
      const cityInput = document.getElementById("city");
      const stateInput = document.getElementById("state");
      const latInput = document.getElementById("latitude");
      const lngInput = document.getElementById("longitude");

      // Search/filter ZIP codes as user types
      zipInput.addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();

        if (searchTerm.length === 0) {
          zipDropdown.classList.remove("show");
          return;
        }

        // Filter ZIP codes
        const matches = Object.entries(zipData).filter(([zip, data]) => {
          return (
            zip.includes(searchTerm) ||
            data.city.toLowerCase().includes(searchTerm) ||
            data.state.toLowerCase().includes(searchTerm)
          );
        });

        // Show dropdown with results
        if (matches.length > 0) {
          zipDropdown.innerHTML = matches
            .map(
              ([zip, data]) => `
                    <div class="zip-option" data-zip="${zip}">
                        <span class="zip-code-text">${zip}</span> - 
                        <span class="city-text">${data.city}, ${data.state}</span>
                    </div>
                `
            )
            .join("");
          zipDropdown.classList.add("show");

          // Add click handlers to options
          document.querySelectorAll(".zip-option").forEach((option) => {
            option.addEventListener("click", function () {
              selectZip(this.dataset.zip);
            });
          });
        } else {
          zipDropdown.classList.remove("show");
        }
      });

      // Select a ZIP code
      function selectZip(zip) {
        const data = zipData[zip];

        zipInput.value = zip;
        cityInput.value = data.city;
        stateInput.value = data.state;
        latInput.value = data.lat;
        lngInput.value = data.lng;

        zipDropdown.classList.remove("show");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".zip-search-wrapper")) {
          zipDropdown.classList.remove("show");
        }
      });

      // Show all options when clicking in the input
      zipInput.addEventListener("focus", function () {
        if (this.value.length > 0) {
          this.dispatchEvent(new Event("input"));
        }
      });
    </script>
  </body>
</html>
